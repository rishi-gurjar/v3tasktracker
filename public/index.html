<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>v3 task tracker</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

</head>
<body>
    <h1>v3</h1>

    <div id = "t-div">

        <h2>Tasks</h2>
        
        <button id="view-tasks">View all tasks</button>
        <div id="cards"></div>


        <button id="view-tasks-today">View today's tasks</button>
        <div id="cards2"></div>
    
<br>
<br>

        <div id="table_div"></div>



        <script>

            let apiKey1 = '6cd8dea3d71bd02098090d1b8e0cb081';
            let token1 = 'ATTAba67372b1bd203630a1176d60cabb2607a7990ba784151e467b341a5447023faE22124CE';
            let boardId1 = '6499f8aa7ecd1d6854a8586c';
            let isClicked = false; // Declare isClicked here

google.charts.load('current', {'packages':['table']});
google.charts.setOnLoadCallback(fetchData);

function fetchData() {
  fetch('/data') // Fetch from the same host and port where the front-end is served
    .then(response => response.json())
    .then(data => {
      console.log(data);
      drawTable(data);
    })
    .catch(error => console.error('Error:', error));
}

function drawTable(dataRows) {
    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Name');
    data.addColumn('string', 'List');
    data.addColumn('string', 'Due Date');
    data.addRows(dataRows); // Here we are passing fetched data

    var table = new google.visualization.Table(document.getElementById('table_div'));
    table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
}



    document.getElementById("view-tasks").addEventListener("click", function() {
    if (!isClicked) {
        isClicked = true;
        boonk();
    } else {
        document.getElementById("cards").textContent = "";
        isClicked = false;
    }
});

function boonk() {
    fetch(`https://api.trello.com/1/boards/${boardId1}/cards?key=${apiKey1}&token=${token1}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(cards => {
            let cardsDiv = document.getElementById('cards');
            cards.forEach(card => {
                let cardElement = document.createElement('h3');
                cardElement.textContent = card.name;
                cardsDiv.appendChild(cardElement);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
}



let isClicked1 = false; // Declare isClicked here

document.getElementById("view-tasks-today").addEventListener("click", function() {
    if (!isClicked1) {
        isClicked1 = true;
        boonk_today();
    } else {
        document.getElementById("cards2").textContent = "";
        isClicked1 = false;
    }
});

function boonk_today() {
    fetch(`https://api.trello.com/1/boards/${boardId1}/cards?key=${apiKey1}&token=${token1}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(cards => {
            let cardsDiv = document.getElementById('cards2');
            cards.forEach(card => {
                if (card.idList === '6499f8b6309787a7edbb08fd') { // Replace 'YOUR_TODAY_LIST_ID' with the actual ID of the "today" list
                    let cardElement = document.createElement('h3');
                    cardElement.textContent = card.name;
                    cardsDiv.appendChild(cardElement);
                }
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });

}
        </script>

    </div>
</body>
</html>